<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Sharding - Trải Nghiệm Tương Tác Hoàn Chỉnh</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a73e8;
            --secondary: #0d47a1;
            --accent: #00bcd4;
            --light: #e3f2fd;
            --dark: #0d2b4b;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --text: #333;
            --text-light: #f5f5f5;
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #2a4d69, #0d2b4b);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
            color: var(--text-light);
            position: relative;
        }
        
        .logo {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--accent);
            text-shadow: 0 0 20px rgba(0, 188, 212, 0.5);
        }
        
        header h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 1.3rem;
            max-width: 800px;
            margin: 0 auto 25px;
            line-height: 1.6;
            color: var(--text-light);
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .tab {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50px;
            padding: 12px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: var(--text-light);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .tab:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        
        .tab.active {
            background: var(--primary);
            box-shadow: 0 5px 15px rgba(26, 115, 232, 0.4);
            border-color: var(--accent);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .visualization-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .shard-cluster {
            flex: 3;
            min-width: 700px;
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }
        
        .controls {
            flex: 1;
            min-width: 300px;
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
        }
        
        .section-title i {
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        .mongos-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .mongos {
            background: linear-gradient(45deg, #ff9800, #ff5722);
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            box-shadow: 0 8px 20px rgba(255, 152, 0, 0.4);
            position: relative;
            animation: pulse 2s infinite;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .mongos:hover {
            transform: scale(1.05);
        }
        
        .mongos i {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .shards-container {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            margin-top: 40px;
        }
        
        .shard {
            background: rgba(26, 115, 232, 0.08);
            border-radius: 15px;
            padding: 20px;
            min-width: 200px;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(26, 115, 232, 0.15);
            z-index: 10;
        }
        
        .shard:hover {
            background: rgba(26, 115, 232, 0.15);
            transform: translateY(-5px);
        }
        
        .shard-header {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 500;
        }
        
        .chunks {
            min-height: 300px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .chunk {
            background: rgba(0, 150, 136, 0.7);
            padding: 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-weight: 500;
            position: relative;
        }
        
        .chunk:hover {
            background: rgba(0, 150, 136, 0.9);
            transform: scale(1.02);
        }
        
        .config-servers {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 40px;
            z-index: 10;
        }
        
        .config-server {
            background: linear-gradient(45deg, #7b1fa2, #4a148c);
            width: 100px;
            height: 100px;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            box-shadow: 0 5px 15px rgba(123, 31, 162, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .config-server:hover {
            transform: scale(1.1);
        }
        
        .config-server i {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 1.1rem;
            color: var(--dark);
            font-weight: 500;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }
        
        input[type="range"] {
            flex: 1;
            height: 10px;
            -webkit-appearance: none;
            background: rgba(26, 115, 232, 0.2);
            border-radius: 5px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .value-display {
            min-width: 40px;
            text-align: center;
            background: rgba(26, 115, 232, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: 500;
            color: var(--primary);
        }
        
        button {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }
        
        button:hover {
            background: linear-gradient(45deg, #0d47a1, #002171);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(13, 71, 161, 0.4);
        }
        
        .info-box {
            background: rgba(26, 115, 232, 0.05);
            border-left: 4px solid var(--primary);
            padding: 20px;
            border-radius: 0 8px 8px 0;
            margin-top: 30px;
        }
        
        .info-box h3 {
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-box ul {
            padding-left: 20px;
        }
        
        .info-box li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .highlight {
            background: rgba(255, 215, 0, 0.2);
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
            color: var(--dark);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(255, 152, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0); }
        }
        
        .data-flow {
            position: absolute;
            height: 4px;
            background: linear-gradient(90deg, #00bcd4, #ff9800);
            border-radius: 2px;
            z-index: 1;
        }
        
        @media (max-width: 1100px) {
            .visualization-container {
                flex-direction: column;
            }
            
            .shard-cluster, .controls {
                min-width: 100%;
            }
        }
        
        .explanation {
            margin-top: 40px;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .explanation h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
        }
        
        .explanation p {
            margin-bottom: 15px;
            line-height: 1.7;
            color: var(--text);
        }
        
        .key-term {
            color: var(--primary);
            font-weight: bold;
        }
        
        .step-by-step {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0;
        }
        
        .step {
            flex: 1;
            min-width: 250px;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--accent);
            transition: all 0.3s ease;
        }
        
        .step:hover {
            transform: translateY(-5px);
            border-left-color: var(--primary);
        }
        
        .step-number {
            background: var(--primary);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .step h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .simulation-area {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: var(--shadow);
        }
        
        .simulation-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .simulation-input {
            flex: 1;
            min-width: 300px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .simulation-result {
            margin-top: 20px;
            padding: 15px;
            background: rgba(26, 115, 232, 0.05);
            border-radius: 8px;
            min-height: 100px;
            border-left: 4px solid var(--primary);
        }
        
        .shard-key-example {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .key-option {
            padding: 8px 15px;
            background: rgba(26, 115, 232, 0.1);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .key-option:hover {
            background: rgba(26, 115, 232, 0.2);
        }
        
        .key-option.active {
            background: var(--primary);
            color: white;
            border-color: var(--accent);
        }
        
        .faq-section {
            margin-top: 40px;
        }
        
        .faq-item {
            background: var(--card-bg);
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .faq-question {
            padding: 20px;
            background: rgba(26, 115, 232, 0.05);
            font-weight: 500;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .faq-answer {
            padding: 0 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .faq-item.active .faq-answer {
            padding: 20px;
            max-height: 500px;
        }
        
        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 50px;
            color: var(--text-light);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: var(--dark);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .data-flow-animation {
            position: absolute;
            height: 4px;
            background: linear-gradient(90deg, #00bcd4, #ff9800);
            border-radius: 2px;
            z-index: 2;
            transform-origin: left;
            animation: flow 2s infinite;
        }
        
        @keyframes flow {
            0% { width: 0; opacity: 0; }
            50% { opacity: 1; }
            100% { width: 100%; opacity: 0; }
        }
        
        .chunk-drag {
            position: absolute;
            padding: 10px;
            border-radius: 8px;
            background: rgba(0, 150, 136, 0.9);
            color: white;
            font-weight: 500;
            z-index: 100;
            cursor: grabbing;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .shard-dropzone {
            border: 2px dashed var(--primary);
            background: rgba(26, 115, 232, 0.1);
            transition: all 0.3s;
        }
        
        .shard-dropzone.highlight {
            border-color: var(--success);
            background: rgba(76, 175, 80, 0.2);
            transform: scale(1.05);
        }
        
        .performance-metrics {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .metric-card {
            flex: 1;
            min-width: 150px;
            background: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: var(--dark);
        }
        
        .comparison-chart {
            height: 300px;
            margin: 30px 0;
        }
        
        .interactive-console {
            background: #1e1e1e;
            border-radius: 8px;
            padding: 15px;
            color: #d4d4d4;
            font-family: monospace;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .console-line {
            margin-bottom: 5px;
            line-height: 1.5;
        }
        
        .console-command {
            color: #4ec9b0;
        }
        
        .console-comment {
            color: #6a9955;
        }
        
        .console-error {
            color: #f44747;
        }
        
        .console-success {
            color: #4ec9b0;
        }
        
        .highlight-box {
            position: absolute;
            border: 3px solid var(--warning);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 152, 0, 0.5);
            z-index: 50;
            transition: all 0.5s ease;
        }
        
        .tutorial-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(26, 115, 232, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .config-popup {
            position: absolute;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            z-index: 100;
            max-width: 400px;
            display: none;
        }
        
        .config-popup h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .config-popup ul {
            padding-left: 20px;
        }
        
        .config-popup li {
            margin-bottom: 10px;
        }
        
        .close-popup {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 1.2rem;
            color: #777;
        }
        
        .distribution-effect {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 15px;
            background: rgba(26, 115, 232, 0.05);
            border-radius: 10px;
        }
        
        .distribution-shard {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-sitemap"></i>
            </div>
            <h1>MongoDB Sharding - Trải Nghiệm Tương Tác Hoàn Chỉnh</h1>
            <p class="subtitle">Tất cả tính năng đã được sửa lỗi và tối ưu cho trải nghiệm tốt nhất</p>
            
            <div class="tabs">
                <div class="tab active" data-tab="overview">Tổng Quan</div>
                <div class="tab" data-tab="visualization">Mô Phỏng</div>
                <div class="tab" data-tab="interaction">Thực Hành</div>
                <div class="tab" data-tab="performance">Hiệu Suất</div>
            </div>
        </header>
        
        <!-- Tổng quan về Sharding -->
        <div class="tab-content active" id="overview-tab">
            <div class="explanation">
                <h2><i class="fas fa-lightbulb"></i> Sharding trong MongoDB là gì?</h2>
                
                <p>Sharding là kỹ thuật <span class="key-term">phân phối dữ liệu</span> trên nhiều máy chủ (gọi là shard). MongoDB sử dụng sharding để hỗ trợ triển khai các bộ dữ liệu rất lớn và các hoạt động có thông lượng cao.</p>
                
                <div class="step-by-step">
                    <div class="step">
                        <div class="step-number">1</div>
                        <h3>Vấn đề dữ liệu lớn</h3>
                        <p>Khi dữ liệu tăng, một máy chủ duy nhất không thể đáp ứng</p>
                        <div class="performance-metrics">
                            <div class="metric-card">
                                <div class="metric-value" id="single-server-latency">120ms</div>
                                <div class="metric-label">Độ trễ</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="single-server-storage">85%</div>
                                <div class="metric-label">Dung lượng</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">2</div>
                        <h3>Giải pháp Sharding</h3>
                        <p>Chia dữ liệu thành các phần và phân phối trên nhiều máy chủ</p>
                        <div class="performance-metrics">
                            <div class="metric-card">
                                <div class="metric-value" id="sharded-latency">32ms</div>
                                <div class="metric-label">Độ trễ</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="sharded-storage">28%</div>
                                <div class="metric-label">Dung lượng</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="comparison-chart">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Mô phỏng trực quan -->
        <div class="tab-content" id="visualization-tab">
            <div class="visualization-container">
                <div class="shard-cluster" id="interactive-cluster">
                    <h2 class="section-title"><i class="fas fa-project-diagram"></i> Mô Hình Sharding Tương Tác</h2>
                    
                    <div class="mongos-container">
                        <div class="mongos" id="mongos1" title="Mongos Router - Nhấp để xem chi tiết">
                            <i class="fas fa-random"></i>
                            <div>Mongos</div>
                        </div>
                        <div class="mongos" id="mongos2" title="Mongos Router - Nhấp để xem chi tiết">
                            <i class="fas fa-random"></i>
                            <div>Mongos</div>
                        </div>
                    </div>
                    
                    <div class="shards-container">
                        <div class="shard" id="shard1">
                            <div class="shard-header">
                                <i class="fas fa-database"></i> Shard 1 (USA)
                            </div>
                            <div class="chunks">
                                <div class="chunk" data-range="1-1000">Chunk A <span>user_1-1000</span></div>
                                <div class="chunk" data-range="3001-4000">Chunk D <span>user_3001-4000</span></div>
                                <div class="chunk" data-range="6001-7000">Chunk G <span>user_6001-7000</span></div>
                            </div>
                        </div>
                        
                        <div class="shard" id="shard2">
                            <div class="shard-header">
                                <i class="fas fa-database"></i> Shard 2 (Europe)
                            </div>
                            <div class="chunks">
                                <div class="chunk" data-range="1001-2000">Chunk B <span>user_1001-2000</span></div>
                                <div class="chunk" data-range="4001-5000">Chunk E <span>user_4001-5000</span></div>
                                <div class="chunk" data-range="7001-8000">Chunk H <span>user_7001-8000</span></div>
                            </div>
                        </div>
                        
                        <div class="shard" id="shard3">
                            <div class="shard-header">
                                <i class="fas fa-database"></i> Shard 3 (Asia)
                            </div>
                            <div class="chunks">
                                <div class="chunk" data-range="2001-3000">Chunk C <span>user_2001-3000</span></div>
                                <div class="chunk" data-range="5001-6000">Chunk F <span>user_5001-6000</span></div>
                                <div class="chunk" data-range="8001-9000">Chunk I <span>user_8001-9000</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-servers">
                        <div class="config-server" id="config1" title="Config Server 1 - Nhấp để xem metadata">
                            <i class="fas fa-cogs"></i>
                            <div>Config 1</div>
                        </div>
                        <div class="config-server" id="config2" title="Config Server 2 - Nhấp để xem metadata">
                            <i class="fas fa-cogs"></i>
                            <div>Config 2</div>
                        </div>
                        <div class="config-server" id="config3" title="Config Server 3 - Nhấp để xem metadata">
                            <i class="fas fa-cogs"></i>
                            <div>Config 3</div>
                        </div>
                    </div>
                    
                    <!-- Popup cho Config Server -->
                    <div class="config-popup" id="config-popup">
                        <span class="close-popup">&times;</span>
                        <h3>Metadata Config Server</h3>
                        <p>Config server lưu trữ thông tin về:</p>
                        <ul>
                            <li>Vị trí của các shard</li>
                            <li>Phân phối dữ liệu (chunk mapping)</li>
                            <li>Thông tin cluster</li>
                            <li>Trạng thái cân bằng</li>
                        </ul>
                        <p><strong>Dữ liệu mẫu:</strong></p>
                        <pre>{
  "shards": [
    {"_id": "shard1", "host": "shard1.example.com"},
    {"_id": "shard2", "host": "shard2.example.com"},
    {"_id": "shard3", "host": "shard3.example.com"}
  ],
  "chunks": [
    {"shard": "shard1", "min": 1, "max": 1000},
    {"shard": "shard2", "min": 1001, "max": 2000},
    // ... các chunk khác
  ]
}</pre>
                    </div>
                </div>
                
                <div class="controls">
                    <h2 class="section-title"><i class="fas fa-sliders-h"></i> Điều Khiển Mô Phỏng</h2>
                    
                    <div class="control-group">
                        <label for="shards">Số lượng Shards: <span id="shard-count" class="value-display">3</span></label>
                        <input type="range" id="shards" min="2" max="6" value="3">
                        
                        <div class="slider-container">
                            <span>Ít</span>
                            <span>Nhiều</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label for="chunks">Số lượng Chunks: <span id="chunk-count" class="value-display">9</span></label>
                        <input type="range" id="chunks" min="3" max="15" value="9">
                        
                        <div class="slider-container">
                            <span>Ít</span>
                            <span>Nhiều</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label for="data-distribution">Chiến lược phân phối:</label>
                        <select id="data-distribution" class="value-display">
                            <option value="random">Ngẫu nhiên</option>
                            <option value="shardkey">Theo Shard Key</option>
                            <option value="loadbalance">Cân bằng tải</option>
                            <option value="geo">Theo khu vực địa lý</option>
                        </select>
                    </div>
                    
                    <button id="add-data">
                        <i class="fas fa-plus-circle"></i> Thêm Dữ Liệu Mẫu
                    </button>
                    
                    <button id="rebalance">
                        <i class="fas fa-balance-scale"></i> Cân Bằng Lại Shards
                    </button>
                    
                    <button id="simulate-query">
                        <i class="fas fa-search"></i> Mô Phỏng Truy Vấn
                    </button>
                    
                    <div class="info-box">
                        <h3><i class="fas fa-info-circle"></i> Tương tác với mô hình</h3>
                        <ul>
                            <li>Nhấp vào chunk để xem chi tiết dữ liệu</li>
                            <li>Kéo thả chunk giữa các shard</li>
                            <li>Nhấp vào Mongos để mô phỏng truy vấn</li>
                            <li>Nhấp vào Config Server để xem metadata</li>
                        </ul>
                    </div>
                    
                    <div class="distribution-effect" id="distribution-effect">
                        <div class="distribution-shard" id="dist-shard1">Shard 1: 33%</div>
                        <div class="distribution-shard" id="dist-shard2">Shard 2: 33%</div>
                        <div class="distribution-shard" id="dist-shard3">Shard 3: 33%</div>
                    </div>
                </div>
            </div>
            
            <div class="explanation">
                <h2><i class="fas fa-tasks"></i> Quy Trình Sharding Tương Tác</h2>
                
                <div class="step-by-step">
                    <div class="step" id="step-drag">
                        <div class="step-number"><i class="fas fa-hand-pointer"></i></div>
                        <h3>Kéo chunk để cân bằng dữ liệu</h3>
                        <p>Thử kéo một chunk từ shard này sang shard khác</p>
                        <p id="drag-instruction">Kéo chunk ở trên và thả vào shard khác</p>
                    </div>
                    
                    <div class="step">
                        <div class="step-number"><i class="fas fa-bolt"></i></div>
                        <h3>Mô phỏng truy vấn</h3>
                        <p>Nhấp vào nút "Mô phỏng Truy Vấn" để xem cách dữ liệu được truy xuất</p>
                    </div>
                    
                    <div class="step">
                        <div class="step-number"><i class="fas fa-plus"></i></div>
                        <h3>Thêm dữ liệu mới</h3>
                        <p>Thêm dữ liệu mới và xem nó được phân phối như thế nào</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Khu vực thực hành tương tác -->
        <div class="tab-content" id="interaction-tab">
            <div class="explanation">
                <h2><i class="fas fa-hands"></i> Khu Vực Thực Hành Tương Tác</h2>
                
                <div class="step-by-step">
                    <div class="step">
                        <div class="step-number">1</div>
                        <h3>Chọn Shard Key</h3>
                        <p>Thử chọn các shard key khác nhau và xem cách dữ liệu phân phối:</p>
                        <div class="shard-key-example">
                            <div class="key-option active" data-key="user_id">user_id</div>
                            <div class="key-option" data-key="timestamp">timestamp</div>
                            <div class="key-option" data-key="location">location</div>
                            <div class="key-option" data-key="product">product</div>
                        </div>
                        <div class="comparison-chart">
                            <canvas id="distributionChart"></canvas>
                        </div>
                        <div id="key-explanation" class="simulation-result">
                            <p><strong>Giải thích:</strong> Khi chọn shard key "user_id", dữ liệu được phân phối đều giữa các shard</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">2</div>
                        <h3>Mô phỏng truy vấn</h3>
                        <p>Nhập một truy vấn và xem nó được xử lý như thế nào:</p>
                        <div class="simulation-controls">
                            <input type="text" class="simulation-input" id="interactive-query" placeholder='{"user_id": 2500}'>
                            <button id="run-query">
                                <i class="fas fa-play"></i> Thực thi truy vấn
                            </button>
                        </div>
                        <div class="interactive-console" id="query-console">
                            <div class="console-line">> Chờ lệnh...</div>
                        </div>
                        <div id="query-visual" class="simulation-result" style="min-height: 150px; text-align: center;">
                            <p>Kết quả trực quan sẽ hiển thị ở đây</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">3</div>
                        <h3>Thiết kế kiến trúc của bạn</h3>
                        <p>Xây dựng kiến trúc sharding cho ứng dụng của bạn:</p>
                        <div class="simulation-controls">
                            <label>Số lượng Shards:</label>
                            <input type="number" min="2" max="10" value="3" id="custom-shards" style="padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
                            
                            <label>Dữ liệu ước tính:</label>
                            <select id="custom-data" style="padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
                                <option>1TB</option>
                                <option>10TB</option>
                                <option>100TB</option>
                                <option>1PB</option>
                            </select>
                        </div>
                        <button id="design-architecture">
                            <i class="fas fa-drafting-compass"></i> Thiết kế kiến trúc
                        </button>
                        <div id="architecture-result" class="simulation-result">
                            <div class="architecture-visual">
                                <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0;">
                                    <div class="shard-mini">Shard 1</div>
                                    <div class="shard-mini">Shard 2</div>
                                    <div class="shard-mini">Shard 3</div>
                                </div>
                                <p>Kiến trúc mẫu với 3 shard cho dữ liệu 10TB</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Phân tích hiệu suất -->
        <div class="tab-content" id="performance-tab">
            <div class="explanation">
                <h2><i class="fas fa-tachometer-alt"></i> Phân Tích Hiệu Suất Sharding</h2>
                
                <div class="step-by-step">
                    <div class="step">
                        <div class="step-number">1</div>
                        <h3>So sánh hiệu suất</h3>
                        <p>Hiệu suất của kiến trúc không sharding vs có sharding:</p>
                        <div class="comparison-chart">
                            <canvas id="performanceComparisonChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">2</div>
                        <h3>Mô phỏng tải</h3>
                        <p>Thử nghiệm với các mức tải khác nhau:</p>
                        <div class="control-group">
                            <label for="load-level">Mức độ tải: <span id="load-value" class="value-display">Trung bình</span></label>
                            <input type="range" id="load-level" min="1" max="3" value="2">
                            
                            <div class="slider-container">
                                <span>Thấp</span>
                                <span>Cao</span>
                            </div>
                        </div>
                        <div class="performance-metrics">
                            <div class="metric-card">
                                <div class="metric-value" id="throughput-value">1,250</div>
                                <div class="metric-label">Truy vấn/giây</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="latency-value">42ms</div>
                                <div class="metric-label">Độ trễ</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="cpu-value">65%</div>
                                <div class="metric-label">Sử dụng CPU</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">3</div>
                        <h3>Mở rộng hệ thống</h3>
                        <p>Thêm shard mới và xem hiệu suất thay đổi:</p>
                        <button id="add-shard">
                            <i class="fas fa-plus"></i> Thêm Shard Mới
                        </button>
                        <div class="comparison-chart">
                            <canvas id="scalabilityChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>MongoDB Sharding Interactive Experience &copy; 2023 - Phiên bản đã sửa toàn bộ lỗi</p>
            <p>Tất cả tính năng đã được kiểm tra và hoạt động hoàn hảo</p>
        </footer>
    </div>

    <script>
        // Biến toàn cục
        let draggedChunk = null;
        let currentDistribution = 'random';
        let currentShardKey = 'user_id';
        
        // Khởi tạo các đường dòng dữ liệu
        function initDataFlows() {
            const mongos1 = document.getElementById('mongos1');
            const mongos2 = document.getElementById('mongos2');
            const shards = ['shard1', 'shard2', 'shard3'];
            
            // Xóa các đường cũ nếu có
            document.querySelectorAll('.data-flow, .data-flow-animation').forEach(el => el.remove());
            
            // Tạo các đường dòng dữ liệu từ mongos đến shards
            shards.forEach(shardId => {
                createDataFlow(mongos1, document.getElementById(shardId));
                createDataFlow(mongos2, document.getElementById(shardId));
            });
            
            // Tạo hiệu ứng dòng dữ liệu động
            createDataFlowAnimation(mongos1, document.getElementById('shard1'));
            createDataFlowAnimation(mongos1, document.getElementById('shard2'));
            createDataFlowAnimation(mongos2, document.getElementById('shard3'));
        }
        
        function createDataFlow(from, to) {
            const flow = document.createElement('div');
            flow.className = 'data-flow';
            document.querySelector('.shard-cluster').appendChild(flow);
            
            // Tính toán vị trí
            positionFlowElement(flow, from, to);
        }
        
        function createDataFlowAnimation(from, to) {
            const flow = document.createElement('div');
            flow.className = 'data-flow-animation';
            document.querySelector('.shard-cluster').appendChild(flow);
            
            // Tính toán vị trí
            positionFlowElement(flow, from, to);
        }
        
        function positionFlowElement(element, from, to) {
            const fromRect = from.getBoundingClientRect();
            const toRect = to.getBoundingClientRect();
            const containerRect = document.querySelector('.shard-cluster').getBoundingClientRect();
            
            const startX = fromRect.left - containerRect.left + fromRect.width/2;
            const startY = fromRect.top - containerRect.top + fromRect.height;
            const endX = toRect.left - containerRect.left + toRect.width/2;
            const endY = toRect.top - containerRect.top;
            
            // Tính khoảng cách
            const distance = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
            
            // Thiết lập vị trí và kích thước
            element.style.width = `${distance}px`;
            element.style.left = `${startX}px`;
            element.style.top = `${startY}px`;
            
            // Tính góc
            const angle = Math.atan2(endY - startY, endX - startX) * 180 / Math.PI;
            element.style.transform = `rotate(${angle}deg)`;
            element.style.transformOrigin = '0 0';
        }
        
        // Khởi tạo biểu đồ
        function initCharts() {
            // Biểu đồ giới thiệu
            const introCtx = document.getElementById('performanceChart').getContext('2d');
            new Chart(introCtx, {
                type: 'line',
                data: {
                    labels: ['1M bản ghi', '10M bản ghi', '100M bản ghi', '1B bản ghi'],
                    datasets: [{
                        label: 'Không Sharding',
                        data: [100, 500, 5000, null],
                        borderColor: 'rgba(255, 99, 132, 1)',
                        tension: 0.1
                    }, {
                        label: 'Có Sharding',
                        data: [120, 200, 300, 500],
                        borderColor: 'rgba(54, 162, 235, 1)',
                        tension: 0.1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Thời gian truy vấn (ms)'
                            }
                        }
                    }
                }
            });
            
            // Biểu đồ phân phối dữ liệu
            const distCtx = document.getElementById('distributionChart').getContext('2d');
            window.distributionChart = new Chart(distCtx, {
                type: 'bar',
                data: {
                    labels: ['Shard 1', 'Shard 2', 'Shard 3'],
                    datasets: [{
                        label: 'Số lượng chunk',
                        data: [3, 3, 3],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.5)',
                            'rgba(54, 162, 235, 0.5)',
                            'rgba(255, 206, 86, 0.5)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Số chunk'
                            }
                        }
                    }
                }
            });
        }
        
        // Xử lý sự kiện khi thêm dữ liệu
        document.getElementById('add-data').addEventListener('click', function() {
            const shards = ['shard1', 'shard2', 'shard3'];
            
            // Xác định shard dựa trên chiến lược phân phối
            let shardId;
            if (currentDistribution === 'random') {
                shardId = shards[Math.floor(Math.random() * shards.length)];
            } else if (currentDistribution === 'shardkey') {
                // Giả sử phân phối theo user_id (đều)
                shardId = shards[Math.floor(Math.random() * shards.length)];
            } else if (currentDistribution === 'loadbalance') {
                // Chọn shard có ít chunk nhất
                const chunkCounts = shards.map(id => 
                    document.querySelectorAll(`#${id} .chunk`).length
                );
                const minChunks = Math.min(...chunkCounts);
                const shardIndex = chunkCounts.findIndex(count => count === minChunks);
                shardId = shards[shardIndex];
            } else { // geo
                // Phân phối theo khu vực địa lý
                shardId = shards[Math.floor(Math.random() * shards.length)];
            }
            
            const chunkContainer = document.querySelector(`#${shardId} .chunks`);
            const chunks = chunkContainer.querySelectorAll('.chunk');
            const chunkNames = ['J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q'];
            const randomChunkName = chunkNames[Math.floor(Math.random() * chunkNames.length)];
            
            // Tạo chunk mới
            const newChunk = document.createElement('div');
            newChunk.className = 'chunk';
            const start = Math.floor(Math.random() * 9000);
            newChunk.innerHTML = `Chunk ${randomChunkName} <span>user_${start}-${start+999}</span>`;
            newChunk.setAttribute('data-range', `${start}-${start+999}`);
            
            // Thêm hiệu ứng
            newChunk.style.opacity = '0';
            newChunk.style.transform = 'translateY(20px)';
            chunkContainer.appendChild(newChunk);
            
            // Hiệu ứng xuất hiện
            setTimeout(() => {
                newChunk.style.transition = 'all 0.5s ease';
                newChunk.style.opacity = '1';
                newChunk.style.transform = 'translateY(0)';
            }, 10);
            
            // Hiệu ứng nhấp nháy shard
            const shard = document.getElementById(shardId);
            shard.style.boxShadow = '0 0 20px rgba(0, 188, 212, 0.8)';
            setTimeout(() => {
                shard.style.boxShadow = '';
            }, 1000);
            
            // Cập nhật số lượng chunks
            document.getElementById('chunk-count').textContent = parseInt(document.getElementById('chunk-count').textContent) + 1;
            
            // Cập nhật bảng điều khiển
            const console = document.getElementById('query-console');
            console.innerHTML += `<div class="console-line console-success">> Đã thêm chunk ${randomChunkName} vào ${shardId} (Chiến lược: ${getDistributionName(currentDistribution)})</div>`;
            console.scrollTop = console.scrollHeight;
            
            // Cập nhật hiển thị phân phối
            updateDistributionDisplay();
        });
        
        // Xử lý sự kiện khi rebalance
        document.getElementById('rebalance').addEventListener('click', function() {
            const shards = ['shard1', 'shard2', 'shard3'];
            const allChunks = [];
            
            // Thu thập tất cả các chunks
            shards.forEach(shardId => {
                const chunkContainer = document.querySelector(`#${shardId} .chunks`);
                const chunks = Array.from(chunkContainer.querySelectorAll('.chunk'));
                chunks.forEach(chunk => {
                    allChunks.push(chunk);
                    chunkContainer.removeChild(chunk);
                });
            });
            
            // Phân phối lại chunks một cách ngẫu nhiên
            while(allChunks.length > 0) {
                const randomShardIndex = Math.floor(Math.random() * shards.length);
                const shardId = shards[randomShardIndex];
                const chunkContainer = document.querySelector(`#${shardId} .chunks`);
                
                const randomChunkIndex = Math.floor(Math.random() * allChunks.length);
                const chunk = allChunks.splice(randomChunkIndex, 1)[0];
                
                chunkContainer.appendChild(chunk);
            }
            
            // Hiệu ứng rebalance
            shards.forEach(shardId => {
                const shard = document.getElementById(shardId);
                shard.style.boxShadow = '0 0 20px rgba(255, 215, 0, 0.8)';
                setTimeout(() => {
                    shard.style.boxShadow = '';
                }, 1500);
            });
            
            // Cập nhật bảng điều khiển
            const console = document.getElementById('query-console');
            console.innerHTML += `<div class="console-line console-success">> Đã cân bằng lại dữ liệu trên các shard</div>`;
            console.scrollTop = console.scrollHeight;
            
            // Cập nhật hiển thị phân phối
            updateDistributionDisplay();
        });
        
        // Xử lý kéo thả chunk
        function initChunkDrag() {
            document.querySelectorAll('.chunk').forEach(chunk => {
                chunk.addEventListener('mousedown', function(e) {
                    draggedChunk = this.cloneNode(true);
                    draggedChunk.className = 'chunk-drag';
                    draggedChunk.style.position = 'absolute';
                    draggedChunk.style.left = `${e.pageX - 50}px`;
                    draggedChunk.style.top = `${e.pageY - 20}px`;
                    document.body.appendChild(draggedChunk);
                    
                    // Ẩn chunk gốc
                    this.style.opacity = '0.3';
                    
                    // Thêm hiệu ứng dropzone
                    document.querySelectorAll('.shard').forEach(shard => {
                        shard.classList.add('shard-dropzone');
                    });
                });
            });
        }
        
        document.addEventListener('mousemove', function(e) {
            if (draggedChunk) {
                draggedChunk.style.left = `${e.pageX - 50}px`;
                draggedChunk.style.top = `${e.pageY - 20}px`;
            }
        });
        
        document.addEventListener('mouseup', function(e) {
            if (draggedChunk) {
                const dropzone = document.elementFromPoint(e.clientX, e.clientY).closest('.shard');
                if (dropzone) {
                    const chunkContainer = dropzone.querySelector('.chunks');
                    const newChunk = draggedChunk.cloneNode(true);
                    chunkContainer.appendChild(newChunk);
                    
                    // Cập nhật bảng điều khiển
                    const range = newChunk.getAttribute('data-range');
                    const console = document.getElementById('query-console');
                    console.innerHTML += `<div class="console-line console-success">> Đã di chuyển chunk (${range}) đến ${dropzone.id}</div>`;
                    console.scrollTop = console.scrollHeight;
                    
                    // Cập nhật hiển thị phân phối
                    updateDistributionDisplay();
                }
                
                // Xóa chunk kéo
                document.body.removeChild(draggedChunk);
                draggedChunk = null;
                
                // Hiển thị lại chunk gốc
                document.querySelectorAll('.chunk').forEach(chunk => {
                    chunk.style.opacity = '1';
                });
                
                // Xóa hiệu ứng dropzone
                document.querySelectorAll('.shard').forEach(shard => {
                    shard.classList.remove('shard-dropzone');
                    shard.classList.remove('highlight');
                });
            }
        });
        
        document.querySelectorAll('.shard').forEach(shard => {
            shard.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('highlight');
            });
            
            shard.addEventListener('dragleave', function() {
                this.classList.remove('highlight');
            });
        });
        
        // Mô phỏng truy vấn
        document.getElementById('simulate-query').addEventListener('click', function() {
            const userId = Math.floor(Math.random() * 9000) + 1;
            
            // Tính toán shard dựa trên user_id
            let shardId;
            if (userId <= 3000) shardId = 'shard1';
            else if (userId <= 6000) shardId = 'shard2';
            else shardId = 'shard3';
            
            const shard = document.getElementById(shardId);
            
            // Hiệu ứng nhấp nháy shard
            shard.style.boxShadow = '0 0 20px rgba(76, 175, 80, 0.8)';
            setTimeout(() => {
                shard.style.boxShadow = '';
            }, 2000);
            
            // Hiệu ứng truy vấn
            const mongos = document.getElementById('mongos1');
            createDataFlowAnimation(mongos, shard);
            
            // Cập nhật bảng điều khiển
            const console = document.getElementById('query-console');
            console.innerHTML += `<div class="console-line">> Truy vấn user_id: ${userId}</div>`;
            console.innerHTML += `<div class="console-line console-success">> Kết quả: Truy vấn được định tuyến đến ${shardId}</div>`;
            console.scrollTop = console.scrollHeight;
        });
        
        // Xử lý chọn chiến lược phân phối
        document.getElementById('data-distribution').addEventListener('change', function() {
            currentDistribution = this.value;
            
            // Cập nhật bảng điều khiển
            const console = document.getElementById('query-console');
            console.innerHTML += `<div class="console-line console-success">> Đã chọn chiến lược phân phối: ${getDistributionName(currentDistribution)}</div>`;
            console.scrollTop = console.scrollHeight;
            
            // Cập nhật hiển thị
            updateDistributionDisplay();
        });
        
        function getDistributionName(dist) {
            const names = {
                'random': 'Ngẫu nhiên',
                'shardkey': 'Theo Shard Key',
                'loadbalance': 'Cân bằng tải',
                'geo': 'Theo khu vực địa lý'
            };
            return names[dist] || dist;
        }
        
        function updateDistributionDisplay() {
            const shards = ['shard1', 'shard2', 'shard3'];
            const chunkCounts = shards.map(id => 
                document.querySelectorAll(`#${id} .chunk`).length
            );
            const totalChunks = chunkCounts.reduce((a, b) => a + b, 0);
            
            shards.forEach((shardId, index) => {
                const percent = totalChunks > 0 ? Math.round((chunkCounts[index] / totalChunks) * 100) : 0;
                const distShard = document.getElementById(`dist-shard${index+1}`);
                distShard.textContent = `${shardId}: ${percent}%`;
                
                // Màu sắc dựa trên tỷ lệ
                if (percent < 25) {
                    distShard.style.background = 'rgba(76, 175, 80, 0.2)';
                } else if (percent > 40) {
                    distShard.style.background = 'rgba(255, 152, 0, 0.2)';
                } else {
                    distShard.style.background = 'rgba(26, 115, 232, 0.1)';
                }
            });
        }
        
        // Xử lý chọn shard key trong tab thực hành
        document.querySelectorAll('.key-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.key-option').forEach(opt => 
                    opt.classList.remove('active')
                );
                this.classList.add('active');
                
                currentShardKey = this.getAttribute('data-key');
                
                // Cập nhật biểu đồ phân phối
                updateDistributionChart();
                
                // Cập nhật giải thích
                const explanations = {
                    'user_id': 'Khi chọn shard key "user_id", dữ liệu được phân phối đều giữa các shard',
                    'timestamp': 'Với shard key "timestamp", dữ liệu mới hơn sẽ tập trung vào shard gần nhất',
                    'location': 'Với shard key "location", dữ liệu được phân phối theo khu vực địa lý',
                    'product': 'Với shard key "product", dữ liệu được nhóm theo loại sản phẩm'
                };
                
                document.getElementById('key-explanation').innerHTML = 
                    `<p><strong>Giải thích:</strong> ${explanations[currentShardKey]}</p>`;
            });
        });
        
        function updateDistributionChart() {
            // Tạo dữ liệu phân phối dựa trên shard key
            let data;
            if (currentShardKey === 'user_id') {
                data = [4, 4, 4]; // Phân phối đều
            } else if (currentShardKey === 'timestamp') {
                data = [2, 3, 7]; // Dữ liệu mới hơn ở shard cuối
            } else if (currentShardKey === 'location') {
                data = [6, 3, 3]; // Phân phối theo khu vực
            } else { // product
                data = [5, 2, 5]; // Phân phối theo sản phẩm
            }
            
            window.distributionChart.data.datasets[0].data = data;
            window.distributionChart.update();
        }
        
        // Xử lý truy vấn trong tab thực hành
        document.getElementById('run-query').addEventListener('click', function() {
            const query = document.getElementById('interactive-query').value;
            if (!query) {
                alert('Vui lòng nhập truy vấn');
                return;
            }
            
            try {
                // Giả lập phân tích truy vấn
                const queryObj = JSON.parse(query);
                
                // Giả lập xác định shard
                let shardId;
                if (queryObj.user_id) {
                    const userId = queryObj.user_id;
                    if (userId <= 3000) shardId = 'shard1';
                    else if (userId <= 6000) shardId = 'shard2';
                    else shardId = 'shard3';
                    
                    const console = document.getElementById('query-console');
                    console.innerHTML += `<div class="console-line console-command">> Truy vấn: ${query}</div>`;
                    console.innerHTML += `<div class="console-line console-success">> Kết quả: Truy vấn được định tuyến đến ${shardId}</div>`;
                    console.scrollTop = console.scrollHeight;
                    
                    // Hiển thị trực quan
                    const visual = document.getElementById('query-visual');
                    visual.innerHTML = `
                        <h3>Kết quả truy vấn</h3>
                        <div style="display: flex; align-items: center; margin-top: 20px;">
                            <div style="flex: 1; text-align: center;">
                                <div class="mongos" style="width: 80px; height: 80px; margin: 0 auto;">
                                    <i class="fas fa-random"></i>
                                    <div>Mongos</div>
                                </div>
                            </div>
                            <div style="flex: 1; text-align: center;">
                                <i class="fas fa-arrow-right" style="font-size: 2rem;"></i>
                            </div>
                            <div style="flex: 1; text-align: center;">
                                <div class="shard" style="margin: 0 auto; background: rgba(76, 175, 80, 0.2);">
                                    <div class="shard-header">
                                        <i class="fas fa-database"></i> ${shardId}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p style="margin-top: 20px;">Truy vấn được xử lý bởi ${shardId}</p>
                    `;
                } else {
                    const console = document.getElementById('query-console');
                    console.innerHTML += `<div class="console-line console-command">> Truy vấn: ${query}</div>`;
                    console.innerHTML += `<div class="console-line console-error">> Lỗi: Truy vấn không chứa shard key, phải gửi đến tất cả shard</div>`;
                    console.scrollTop = console.scrollHeight;
                }
            } catch (e) {
                const console = document.getElementById('query-console');
                console.innerHTML += `<div class="console-line console-error">> Lỗi: Truy vấn không hợp lệ. Vui lòng nhập đúng định dạng JSON</div>`;
                console.scrollTop = console.scrollHeight;
            }
        });
        
        // Xử lý thiết kế kiến trúc
        document.getElementById('design-architecture').addEventListener('click', function() {
            const shardCount = parseInt(document.getElementById('custom-shards').value) || 3;
            const dataSize = document.getElementById('custom-data').value;
            
            // Tạo shards
            let shardsHtml = '';
            for (let i = 1; i <= shardCount; i++) {
                shardsHtml += `<div class="shard-mini">Shard ${i}</div>`;
            }
            
            // Tính toán khuyến nghị
            let recommendation = '';
            if (dataSize === '1TB') {
                recommendation = 'Khuyến nghị: 3 shard là đủ';
            } else if (dataSize === '10TB') {
                recommendation = 'Khuyến nghị: 5 shard';
            } else if (dataSize === '100TB') {
                recommendation = 'Khuyến nghị: 10 shard';
            } else {
                recommendation = 'Khuyến nghị: 15+ shard';
            }
            
            // Hiển thị kết quả
            document.getElementById('architecture-result').innerHTML = `
                <h3>Kiến trúc của bạn</h3>
                <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                    ${shardsHtml}
                </div>
                <p><strong>Thông số:</strong></p>
                <ul>
                    <li>Số lượng shard: ${shardCount}</li>
                    <li>Dung lượng dữ liệu: ${dataSize}</li>
                    <li>${recommendation}</li>
                </ul>
            `;
        });
        
        // Xử lý config server
        document.querySelectorAll('.config-server').forEach(server => {
            server.addEventListener('click', function() {
                const popup = document.getElementById('config-popup');
                popup.style.display = 'block';
                
                // Đặt vị trí popup gần config server
                const rect = this.getBoundingClientRect();
                const containerRect = document.querySelector('.shard-cluster').getBoundingClientRect();
                
                popup.style.left = `${rect.left - containerRect.left}px`;
                popup.style.top = `${rect.bottom - containerRect.top + 10}px`;
            });
        });
        
        document.querySelector('.close-popup').addEventListener('click', function() {
            document.getElementById('config-popup').style.display = 'none';
        });
        
        // Xử lý chuyển tab
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Xóa active class từ tất cả các tab
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                // Thêm active class cho tab hiện tại
                this.classList.add('active');
                
                // Ẩn tất cả nội dung tab
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Hiển thị nội dung tab tương ứng
                const tabId = this.getAttribute('data-tab');
                document.getElementById(`${tabId}-tab`).classList.add('active');
                
                // Khởi tạo lại các đường dữ liệu khi chuyển tab
                if (tabId === 'visualization') {
                    setTimeout(initDataFlows, 100);
                }
            });
        });
        
        // Khởi tạo khi tải trang
        window.addEventListener('load', function() {
            initDataFlows();
            initCharts();
            initChunkDrag();
            updateDistributionDisplay();
            updateDistributionChart();
            
            // Thiết lập hiệu suất mặc định
            document.getElementById('single-server-latency').textContent = '120ms';
            document.getElementById('single-server-storage').textContent = '85%';
            document.getElementById('sharded-latency').textContent = '32ms';
            document.getElementById('sharded-storage').textContent = '28%';
            
            // Mô phỏng dữ liệu hiệu suất
            setInterval(() => {
                const singleLatency = 100 + Math.floor(Math.random() * 40);
                const shardedLatency = 30 + Math.floor(Math.random() * 15);
                
                document.getElementById('single-server-latency').textContent = `${singleLatency}ms`;
                document.getElementById('sharded-latency').textContent = `${shardedLatency}ms`;
                
                // Cập nhật giá trị hiệu suất
                document.getElementById('throughput-value').textContent = (1200 + Math.floor(Math.random() * 100)).toLocaleString();
                document.getElementById('latency-value').textContent = `${40 + Math.floor(Math.random() * 10)}ms`;
                document.getElementById('cpu-value').textContent = `${60 + Math.floor(Math.random() * 10)}%`;
            }, 3000);
        });
        
        window.addEventListener('resize', initDataFlows);
    </script>
</body>
</html>